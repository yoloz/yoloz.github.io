---
title: ncat(nc)
comments: false
toc: false
date: 2020-03-10 14:42:04
categories: linux
tags:
---

ncat 或者说 nc 是一款功能类似 cat 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读、写以及重定向数据。 它被设计成可以被脚本或其他程序调用的可靠的后端工具。同时由于它能创建任意所需的连接，因此也是一个很好的网络调试工具。

ncat/nc 既是一个端口扫描工具，也是一款安全工具，还是一款监测工具，甚至可以做为一个简单的 TCP 代理。

在大多数 Debian 发行版中，nc 是默认可用的，它会在安装系统的过程中自动被安装`apt install netcat`。 但是在 CentOS 7/RHEL 7 的最小化安装中，nc 并不会默认被安装。 你需要用下列命令手工安装`yum install nmap-ncat`

## 监听

默认监听tcp端口

8080端口监听连接`ncat -l 8080`

监听UDP端口`ncat -l -u 8080`

## 连接

测试tcp连接`ncat -v ip port`

测试udp连接`ncat -v -u ip port`

``` sh
ncat 192.168.1.100 80
#这会创建一个连接，连接到 IP 为 192.168.1.100 的服务器上的 80 端口，然后我们就可以向服务器发送指令了

#获取页面名称
GET / HTTP/1.1

#我们可以通过以下方式获得操作系统指纹标识
HEAD / HTTP/1.1
#这会告诉我们使用的是什么软件来运行这个 web 服务器的
```

## 通信

配置服务器监听某个端口，然后从远程主机上连接到服务器的这个端口，就可以开始发送消息了。

* 在服务器这端运行：`ncat -l 8080`
* 在远程客户端主机上运行：`ncat 192.168.1.100 8080`

客户端发送消息，这些消息会在服务器终端上显示出来

## 代理

nc 也可以用来做代理。比如下面这个例子

`ncat -l 8080 | ncat 192.168.1.200 80`
所有发往服务器 8080 端口的连接都会自动转发到 192.168.1.200 上的 80 端口。 不过由于使用了管道，数据只能被单向传输。 要同时能够接受返回的数据，需要创建一个双向管道。 使用下面命令可以做到这点

``` sh
mkfifo chan_nel
ncat -l 8080 0<chan_nel | ncat 192.168.1.200 80 1>chan_nel
#现在你可以通过 nc 代理来收发数据了
```

## 拷贝文件

nc 还能用来在系统间拷贝文件，虽然这么做并不推荐，因为绝大多数系统默认都安装了 ssh/scp。 不过如果你恰好遇见个没有 ssh/scp 的系统的话， 你可以用 nc 来作最后的努力。

* 在要接受数据的机器上启动 nc 并让它进入监听模式：`ncat -l  8080 > file.txt`
* 要被拷贝数据的机器上运行下面命令：`ncat 192.168.1.100 8080 --send-only < data.txt`
> data.txt 是要发送的文件, -–send-only 选项会在文件拷贝完后立即关闭连接。 如果不加该选项， 我们需要手工按下 ctrl+c 来关闭连接。
>
>我们也可以用这种方法拷贝整个磁盘分区，不过请一定要小心

## 通过 nc 创建后门

nc 命令还可以用来在系统中创建后门，并且这种技术也确实被黑客大量使用。 为了保护我们的系统，我们需要知道它是怎么做的。 创建后门的命令为：`ncat -l 10000 -e /bin/bash`
> -e 标志将一个 bash 与端口 10000 相连。现在客户端只要连接到服务器上的 10000 端口就能通过 bash 获取我们系统的完整访问权限：`ncat 192.168.1.100 10000`

## 端口转发

我们通过选项 -c 来用 nc 进行端口转发，实现端口转发的语法为：`ncat -u -l  80 -c  'ncat -u -l 8080'`这样，所有连接到 80 端口的连接都会转发到 8080 端口

## 设置连接超时

nc 的监听模式会一直运行，直到手工终止。 不过我们可以通过选项 -w 设置超时时间:`ncat -w 10 192.168.1.100 8080`
这会导致连接 10 秒后终止，**不过这个选项只能用于客户端而不是监听端**

## 使用 -k 选项强制 nc 待命

当客户端从服务端断开连接后，过一段时间服务端也会停止监听。 但通过选项 -k 我们可以强制服务器保持连接并继续监听端口。 命令如下：`ncat -l -k 8080`
现在即使来自客户端的连接断了也依然会处于待命状态




