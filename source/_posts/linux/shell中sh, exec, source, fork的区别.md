---
title: shell中sh, exec, source, fork的区别
comments: false
toc: false
date: 2019-09-18 23:50:33
categories: linux
tags:
---

### sh

​sh是通过创建子进程(subshell)去执行脚本，父进程无法使用子进程中的变量，而子进程对环境变量的修改也不会影响到父进程。父进程中的局部变量子进程也无法使用，子进程会继承父进程的环境变量;

使用 `$ sh script.sh` 执行脚本时，当前shell是父进程，生成一个子shell进程，在子shell中执行脚本。脚本执行完毕，退出子shell，回到当前shell.
> 脚本不需要执行权限
> `$ ./script.sh` 与 `$ sh script.sh` 等效

### source

使用source或者“.”来调用外部脚本，不会产生新的进程，继承当前shell环境变量，而且被调用的脚本运行结束后，它拥有的环境变量和声明变量会被当前shell保留，类似将调用脚本的内容复制过来直接执行。执行完毕后原主shell继续运行。
> `source` 方式也叫点命令， `$ . script.sh` 与 `$ source script.sh` 等效。注意在点命令中， `.` 与 `script.sh` 之间有一个空格。
> 脚本不需要执行权限

### exec

使用exec执行脚本，被执行的脚本会继承当前shell的环境变量，exec相当于创建了新进程，它会将主进程的进程资源占用，使用主进程的pid，而exec语句执行完之后，后续的语句不再执行;
`exec command` 或`./test.sh exec`
> 脚本需要执行权限

### fork

`./test fork`或直接`/directory/script.sh`
使用fork执行脚本的时候会创建一个子进程去执行该脚本，子进程会继承父进程的环境变量和声明变量。当子进程执行完毕后会返回父进程，但是父进程的环境变量不会因子进程的改变而改变。
> 脚本需要执行权限

### ./

​ 创建一个子进程去执行脚本
> 脚本需要执行权限

### ./ 和 sh的使用区别

* 使用“./”执行脚本，对应的xxx.sh脚本必须要有执行权限,使用“sh” 执行脚本，对应的xxx.sh没有执行权限，亦可执行；
* 当脚本开头使用#！设置使用的shell类型时，使用“./”执行脚本时，则使用“#！”标志的shell执行脚本；若无使用“#！”标记，则使用系统设置的默认shell执行脚本；