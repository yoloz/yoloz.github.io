---
title: 用户及组
comments: false
toc: false
date: 2019-09-18 23:57:50
categories:
tags:
---

## 创建用户及组

sudo权限可以通过用户组或修改/etc/sudoers文件

``` shell
$ groupadd gname                         #新建用户组

$ useradd -m uname                       #新建用户并创建用户目录
$ usermod -G sudo -a uname               #新创建的用户加入sudo(超级权限)组
$ usermod -G wheel -a uname              #centos默认没有sudo组,wheel组拥有sudo权限，可能sudo仍没有权限，则可改变主组到wheel,-G换成-g
$ passwd uname                           #新用户设置密码

$ userdel -r uname                       #删除用户
$ groupdel gname                         #删除用户组
$ gpasswd -d uname gname                 #从组gname里删除用户uname
```

> 在centos上可能会出现usermod: group 'sudo' does not exist,
因为centos默认没有sudo组，可以将用户指向wheel用户组, wheel用户组同样有sudo权限。
>
> usermod -g gname uname是把用户的主组变成gname
>
>usermod -G gname uname只是把用户加到gname组，并没有改变主组
>
>修改/etc/sudoers添加 `uname ALL=(ALL) ALL`
>
> 删除用户时携带-r表示完全删除，不添加则home及相关数据保留仅删除用户

### shell中Tab命令无法自动补全

* 修改/etc/passwd中用户的属性

如:tmp:x:1003:1003::/home/tmp:/bin/sh 修改为tmp:x:1003:1003::/home/tmp:/bin/bash

* 在创建时加入相应参数

useradd -s /bin/bash -m username

> 在debian中使用useradd命令创建的用户默认使用dash，Tab无法自动补全
>
> 系统dash配置`sudo dpkg-reconfigure dash`选no，就可以更改默认shell环境



## 查看用户及组

* 用户列表文件：/etc/passwd

* 用户组列表文件：/etc/group

* 查看系统中有哪些用户：`cut -d : -f 1 /etc/passwd`

* 查看可以登录系统的用户：`cat /etc/passwd | grep -v /sbin/nologin | cut -d : -f 1`

* 查看用户：`w`

* 查看某一用户：`w userName`

* 查看登录用户：`who`

* 查看用户登录历史记录：`last`

## 桌面环境卡死

* ctrl+alt+f1进入shell环境
* 查看登录用户`who`
* 踢出桌面环境用户`sudo pkill -kill -t tty7`
> 如果踢出失败则强制踢出`sudo pkill -9 -t tty7`
>
> -t, --terminal <tty,...>  match by controlling terminal

